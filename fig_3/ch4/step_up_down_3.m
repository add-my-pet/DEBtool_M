## Copyright (C) 2008 Bas Kooijman
## 
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.
## 
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## 
## You should have received a copy of the GNU General Public License
## along with this program; if not, write to the Free Software
## Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA

## set_ud_3

## Author: Bas Kooijman <Bas Kooijman@VOSTRO>
## 
## 2008-12-06 Bas Kooijman <Bas Kooijman@VOSTRO>
## * Initial revision

function [ ret ] = step_up_down_3 ()

%% fig:step_up_down
%% out:stepa,stepb,stepc,stepd,stepe,stepf,stepg

%% length (mm) at age (d) with shift up or down for Daphnia magna

%% no shift, high
A1 = [0.5 1.021115039;
      0.5 1.039905132;
      0.5 1.065189774;
      0.5 1.079751093;
      2.5 1.704715786;
      2.5 1.722606649;
      2.5 1.802668782;
      5.5 2.343303789;
      5.5 2.921121135;
      5.5 3.051999361;
      8.5 2.820071901;
      8.5 2.929544615;
      8.5 3.276223828;
      8.5 3.323484136;
      8.5 3.553194021;
      12.5 3.270679065;
      12.5 3.507659325;
      12.5 3.545095539;
      12.5 3.748744956;
      14.5 3.179960021;
      14.5 3.60758003;
      14.5 3.670485992;
      14.5 3.762884803;
      16.5 3.408472608;
      16.5 3.720551537;
      16.5 3.76956917;
      16.5 3.86025179;
      16.5 3.949485596;
      19.5 3.545056057;
      19.5 3.764818444;
      19.5 3.9086035;
      19.5 3.945407859;
      19.5 4.08841709;
      21.5 3.567057001;
      21.5 3.962548175;
      21.5 4.000066658;
      21.5 4.060460036;
      23.5 3.743710295;
      23.5 3.965271142;
      23.5 3.998848793;
      23.5 4.08299573;
      26.5 3.84434748;
      26.5 4.037088467;
      26.5 4.068949929;
      28.5 3.912427291;
      28.5 4.068487323;
      28.5 4.232860931;
      30.5 4.052276227;
      30.5 4.077725407;
      30.5 4.234540698;
      33.5 4.170357525;
      33.5 4.428393654];

%% no shift, low
A2 = [0.5 1.009483467;
      2.5 1.653934002;
      5.5 2.094830067;
      5.5 2.129044553;
      5.5 2.480348075;
      5.5 2.542264148;
      8.5 2.534877697;
      8.5 2.781814102;
      8.5 2.844551822;
      12.5 2.727470735;
      12.5 2.883987924;
      12.5 2.915777653;
      12.5 2.958969978;
      14.5 2.838089144;
      14.5 2.863359277;
      14.5 2.921955278;
      16.5 2.840372842;
      16.5 2.987865314;
      16.5 3.009047304;
      19.5 2.917721052;
      19.5 3.060276946;
      19.5 3.116501767;
      21.5 3.024103984;
      21.5 3.056728753;
      21.5 3.092573139;
      23.5 3.031210409;
      23.5 3.138689988;
      23.5 3.206330799;
      26.5 3.062160071;
      26.5 3.124864305;
      26.5 3.166426731;
      26.5 3.204756148;
      26.5 3.265904151;
      28.5 3.13201761;
      28.5 3.161329004;
      28.5 3.188262521;
      28.5 3.219217209;
      28.5 3.238735816;
      30.5 3.138302388;
      30.5 3.215722593;
      30.5 3.248273695;
      30.5 3.299602121;
      33.5 3.20741404;
      33.5 3.236792405;
      33.5 3.297866741;
      33.5 3.323210541];

%% shift up at 7d
B = [0.5 1.041646462;
     0.5 1.062004793;
     0.5 1.088114228;
     2.5 1.283442378;
     2.5 1.302998011;
     2.5 1.328251861;
     2.5 1.706838678;
     2.5 1.745186911;
     5.5 2.022696492;
     5.5 2.094497439;
     5.5 2.122185827;
     5.5 2.17761549;
     8.5 2.474773257;
     8.5 2.560405177;
     8.5 2.737459787;
     8.5 2.824053068;
     8.5 2.928279259;
     12.5 2.821264109;
     12.5 3.132235352;
     12.5 3.15264657;
     12.5 3.208945041;
     12.5 3.277548419;
     14.5 3.206582589;
     14.5 3.249826342;
     14.5 3.32557467;
     14.5 3.467663724;
     16.5 3.405015756;
     16.5 3.481725445;
     16.5 3.574727087;
     19.5 3.643162854;
     19.5 3.697974926;
     19.5 3.772078192;
     21.5 3.650697216;
     21.5 3.765794804;
     21.5 3.796786537;
     23.5 3.88853253;
     23.5 3.973467528;
     26.5 4.084053467;
     28.5 3.989650734;
     30.5 4.196494315];

%% shift up at 14d
C = [0.5 0.9963255521;
     0.5 1.01831969;
     0.5 1.033812757;
     0.5 1.058275495;
     2.5 1.248241836;
     2.5 1.269450318;
     2.5 1.299621028;
     2.5 1.697630096;
     5.5 2.038840184;
     5.5 2.071449725;
     5.5 2.36826428;
     5.5 2.559822082;
     8.5 2.694048279;
     8.5 2.782870024;
     8.5 2.806509895;
     8.5 2.83586518;
     12.5 2.81454198;
     12.5 2.838204177;
     12.5 2.93119235;
     12.5 2.957285938;
     14.5 2.812097883;
     14.5 2.926279654;
     14.5 2.964589726;
     14.5 3.06814865;
     16.5 2.958898815;
     16.5 2.998076406;
     16.5 3.033992299;
     16.5 3.063362469;
     16.5 3.097595418;
     19.5 3.202998954;
     19.5 3.277973365;
     19.5 3.309782366;
     19.5 3.480206108;
     21.5 3.291148852;
     21.5 3.457450817;
     21.5 3.574864518;
     21.5 3.614820323;
     21.5 3.759090941;
     23.5 3.498090267;
     23.5 3.582175748;
     23.5 3.62771301;
     23.5 3.756602191;
     26.5 3.740648862;
     26.5 3.814096613;
     26.5 3.856461482;
     26.5 3.895601862;
     28.5 3.880073762;
     28.5 3.930659855;
     28.5 4.00318055;
     30.5 3.88428702;
     30.5 3.931492342;
     30.5 3.967266835;
     30.5 4.040662491;
     33.5 4.063931405;
     33.5 4.103842558;
     33.5 4.147875486];

%% shift up at 21 d
D = [0.5 1.047397113;
     0.5 1.057136864;
     2.5 1.272822337;
     2.5 1.298121035;
     2.5 1.329930664;
     5.5 2.043078256;
     5.5 2.05858391;
     5.5 2.078968321;
     5.5 2.165473547;
     8.5 2.592405528;
     8.5 2.620933045;
     8.5 2.756474551;
     8.5 2.800543251;
     8.5 2.824209775;
     12.5 2.753703879;
     12.5 2.787216741;
     12.5 2.863964451;
     12.5 2.885998801;
     12.5 2.961149866;
     14.5 2.815947225;
     14.5 2.840394307;
     14.5 2.924504565;
     14.5 2.957254633;
     16.5 2.841466655;
     16.5 2.871679639;
     16.5 2.947629027;
     16.5 3.008853319;
     19.5 2.922040208;
     19.5 3.033773074;
     19.5 3.097125866;
     21.5 3.001775592;
     21.5 3.032680313;
     21.5 3.095643366;
     23.5 3.035153896;
     23.5 3.142238942;
     23.5 3.221594794;
     26.5 3.293829832;
     26.5 3.341020764;
     26.5 3.39926494;
     26.5 3.436840472;
     26.5 3.539756261;
     28.5 3.450012009;
     28.5 3.481697288;
     28.5 3.60173314;
     28.5 3.655701471;
     28.5 3.715169237;
     30.5 3.682497784;
     30.5 3.717589527;
     30.5 3.755165059;
     30.5 3.823751899;
     33.5 3.71167562;
     33.5 3.755744319;
     33.5 3.790019975;
     33.5 3.884757129;
     33.5 3.936259434];

%% shift down at 7 d
E = [0.5 1.015508599;
     0.5 1.045655368;
     0.5 1.058680423;
     0.5 1.083140014;
     2.5 1.301268706;
     2.5 1.779346959;
     2.5 1.821884005;
     2.5 1.875354083;
     5.5 2.377082145;
     5.5 2.849593581;
     5.5 2.896902184;
     5.5 2.926033032;
     5.5 3.034751396;
     8.5 2.860893233;
     8.5 2.904920498;
     8.5 3.291462281;
     8.5 3.459739104;
     12.5 3.313670525;
     12.5 3.390985476;
     12.5 3.416119966;
     12.5 3.521115666;
     14.5 3.39683014;
     14.5 3.43125411;
     14.5 3.588329971;
     16.5 3.446541587;
     16.5 3.476748537;
     16.5 3.580394441;
     16.5 3.652737233;
     19.5 3.452214243;
     19.5 3.515468157;
     19.5 3.588432815;
     19.5 3.669764184;
     21.5 3.44648395;
     21.5 3.513300045;
     21.5 3.539390276;
     21.5 3.667495772;
     23.5 3.437331896;
     23.5 3.513791407;
     23.5 3.544773556;
     23.5 3.690121127;
     26.5 3.508129827;
     26.5 3.539907236;
     26.5 3.613386311;
     26.5 3.715361455;
     28.5 3.579975268;
     28.5 3.603539299;
     28.5 3.632075488;
     28.5 3.719414998;
     30.5 3.510429375;
     30.5 3.595342986;
     30.5 3.626345195;
     30.5 3.688964331;
     33.5 3.548574397;
     33.5 3.589460744;
     33.5 3.616386355;
     33.5 3.660594161;
     33.5 3.712099724];

%% shift down at 14 d
F = [0.5 1.007916997;
     0.5 1.031457553;
     0.5 1.049360316;
     0.5 1.07543245;
     2.5 1.380174065;
     2.5 1.686543471;
     2.5 1.733886529;
     2.5 1.820425105;
     5.5 2.277119236;
     5.5 2.383655575;
     5.5 2.856118606;
     5.5 2.955365816;
     5.5 3.278008476;
     8.5 2.610479879;
     8.5 2.957652481;
     8.5 3.314092983;
     8.5 3.370311023;
     8.5 3.431264785;
     12.5 3.599151241;
     12.5 3.648851247;
     12.5 3.691240294;
     12.5 3.717268771;
     14.5 3.577532772;
     14.5 3.652402842;
     14.5 3.704590769;
     14.5 3.879719262;
     16.5 3.689752279;
     16.5 3.79485557;
     16.5 3.842067656;
     16.5 3.874592337;
     19.5 3.772786925;
     19.5 3.792297368;
     19.5 3.882822399;
     19.5 3.931620335;
     21.5 3.715559389;
     21.5 3.848233349;
     21.5 3.904560533;
     21.5 3.937107043;
     23.5 3.775765601;
     23.5 3.842466301;
     23.5 3.966883575;
     26.5 3.797009901;
     26.5 3.84576418;
     26.5 3.946881015;
     26.5 4.002327958;
     28.5 3.798997475;
     28.5 3.87717022;
     28.5 3.938495073;
     28.5 3.999601638;
     30.5 3.779932413;
     30.5 3.870966593;
     30.5 3.93222596;
     30.5 4.001589211;
     33.5 3.797874038;
     33.5 3.907029271;
     33.5 4.004094165;
     33.5 4.040779932];

%% shift down at 21 d
G = [0.5 1.034548638;
     0.5 1.050019387;
     0.5 1.060602583;
     0.5 1.088278619;
     2.5 1.316001464;
     2.5 1.743352018;
     2.5 1.767774414;
     2.5 1.798708227;
     5.5 2.303101573;
     5.5 2.350314225;
     5.5 2.902203984;
     5.5 2.930696977;
     5.5 2.969776122;
     8.5 2.850636383;
     8.5 2.88971198;
     8.5 2.92227557;
     8.5 3.375673566;
     8.5 3.46277227;
     12.5 3.60808474;
     12.5 3.637385822;
     12.5 3.658553987;
     12.5 3.688672618;
     14.5 3.545222805;
     14.5 3.604641926;
     14.5 3.623366315;
     14.5 3.681974391;
     16.5 3.758296586;
     16.5 3.785162168;
     16.5 3.81528198;
     16.5 3.857611809;
     19.5 3.92406904;
     19.5 3.954186488;
     19.5 3.991630536;
     19.5 4.059192624;
     21.5 3.929570779;
     21.5 3.958873634;
     21.5 4.015041481;
     21.5 4.080977931;
     23.5 4.049854943;
     23.5 4.067760601;
     23.5 4.097875685;
     23.5 4.158108807;
     26.5 4.034090382;
     26.5 4.092707917;
     26.5 4.130968331;
     28.5 4.021701833;
     28.5 4.093338064;
     28.5 4.128343065;
     30.5 4.073609908;
     30.5 4.093964664;
     30.5 4.131401619;
     33.5 4.051345163;
     33.5 4.091235353;
     33.5 4.166936268]; 


par_txt = ["Length at birth"; "investment ratio";\
	   "maint rate coeff"; "energy conductance";\
	   "scaled func response 1"; "scaled func response 2"];
%% parameters of fig_3_14, except for f1 and f2
p = [.77 0; .11 0; 4.83 0; 2.35 0; .6 1; .9 1];
p = nmregr("bert2", p, A2, A1); % A2 is down, A1 is up
[cov cor sd] = pregr("bert2", p, A2, A1);
printpar(par_txt, p, sd)

na = 100; a = linspace(0,35,na)';
[L1, L2] = bert2(p(:,1), a, a);
%% shift up
LB =  shiftbert(a,  7, 1, p(:,1)); iaB = sum(a< 7); 
LC =  shiftbert(a, 14, 1, p(:,1)); iaC = sum(a<14);
LD =  shiftbert(a, 21, 1, p(:,1)); iaD = sum(a<21);
%% shift down
LE =  shiftbert(a,  7, 0, p(:,1));
LF =  shiftbert(a, 14, 0, p(:,1));
LG =  shiftbert(a, 21, 0, p(:,1));

gset term postscript color solid "Times-Roman" 35
%% multiplot(3,3)

%% subplot(3,3,1); clg;
gset output "stepa.ps"
%% gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (A1(:,1), A1(:,2), '.r', a, L2, 'r',\
    A2(:,1), A2(:,2), '.b', a, L1, 'b')

%% subplot(3,3,4); clg; % up at 7 d
gset output "stepb.ps"
%% gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (B(1:12,1), B(1:12,2), '.b', B(13:40,1), B(13:40,2), '.r',\
     a(1:iaB), LB(1:iaB). 'b', a(iaB:na), LB(iaB:na), 'r')

%% subplot(3,3,5); clg; % up at 14 d
gset output "stepc.ps"
%% gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (C(1:20,1), C(1:20,2), '.b', C(21:56,1), C(21:56,2), '.r',\
    a(1:iaC), LC(1:iaC), 'b', a(iaC:na), LC(iaC:na), 'r')

%% subplot(3,3,6); clg; % up at 21 d
gset output "stepd.ps"
gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (D(1:30,1), D(1:30,2), '.b', D(31:55,1), D(31:55,2), '.r',\
    a(1:iaD), LD(1:iaD), 'b', a(iaD:na), LD(iaD:na), 'r')

%% subplot(3,3,7); clg; % down at 7 d
gset output "stepe.ps"
%% gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (E(1:13,1), E(1:13,2), '.r', E(14:57,1), E(14:57,2), '.b',\
      a(1:iaB), LE(1:iaB), 'r', a(iaB:na), LE(iaB:na), 'b')

%% subplot(3,3,8); clg; % down at 14 d
gset output "stepf.ps"
%% gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (F(1:22,1), F(1:22,2), '.r', F(23:57,1), F(23:57), '.b',\
      a(1:iaC), LF(1:iaC), 'r', a(iaC:na), LF(iaC:na), 'b')

%% subplot(3,3,9); clg; % down at 21 d
gset output "stepg.ps"
%% gset nokey
xlabel("age, d")
ylabel("length, mm")
gset yrange [0:5]
gset ytics 2
plot (G(1:34,1), G(1:34,2), '.r', G(35:54,1), G(35:54,2), '.b',\
      a(1:iaD), LG(1:iaD), 'r', a(iaD:na), LG(iaD:na), 'b')

%% multiplot(0,0)

endfunction
